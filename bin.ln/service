#!/usr/bin/env ruby

def main
  action, service = ARGV

  if action == "start"
    start(service)
  elsif action == "stop"
    stop(service)
  else
    puts "usage: service start/stop <service-name>"
    exit
  end
end

def start(service)
  case service
    when "mysql"
      system("mysql.server start")
    when "postgresql"
      system("pg_ctl -D /usr/local/var/postgres -l /usr/local/var/postgres/server.log start")
    when "mongo"
      system("mongod run --config /usr/local/etc/mongod.conf")
    when "redis-server"
      system("redis-server /usr/local/etc/redis.conf")
    when "sunspot-solr"
      system("rake sunspot:solr:start")
    when "memcached"
      system("/usr/local/bin/memcached -d")
    when "elasticsearch"
      system("elasticsearch -D es.config=/usr/local/opt/elasticsearch/config/elasticsearch.yml")
  end
end

def stop(service)
  case service
    when "mysql"
      system("mysql.server stop")
    when "postgresql"
      system("pg_ctl -D /usr/local/var/postgres stop -s -m fast")
    when "mongo"
      system(%q(/usr/local/bin/mongo --nodb --eval "connect('localhost:27017/admin').shutdownServer()"))
    when "redis-server"
      system("killall -SIGTERM redis-server")
    when "sunspot-solr"
      system("rake sunspot:solr:stop")
  end
end

main
